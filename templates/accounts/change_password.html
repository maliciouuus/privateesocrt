{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block title %}Changer votre mot de passe - EscortDollars{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    .password-card {
        background-color: rgba(var(--bs-light-rgb), 0.5);
        border-radius: 1rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .password-strength-meter {
        height: 8px;
        margin-top: 8px;
        margin-bottom: 15px;
        border-radius: 4px;
        background-color: #eee;
        position: relative;
        overflow: hidden;
    }
    
    .password-strength-meter .strength-value {
        height: 100%;
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    .strength-weak { width: 25%; background-color: #dc3545; }
    .strength-medium { width: 50%; background-color: #ffc107; }
    .strength-good { width: 75%; background-color: #6c757d; }
    .strength-strong { width: 100%; background-color: #28a745; }
    
    .password-tips {
        background-color: rgba(var(--bs-info-rgb), 0.1);
        border-left: 4px solid var(--bs-info);
        padding: 1rem;
        margin-top: 1.5rem;
    }
    
    .password-tips ul {
        padding-left: 1.5rem;
        margin-bottom: 0;
    }
    
    .password-tips li {
        margin-bottom: 0.5rem;
    }
    
    .password-tips li:last-child {
        margin-bottom: 0;
    }
</style>
{% endblock %}

{% block dashboard_content %}
<div class="page-header">
    <div>
        <h2 class="fw-bold">Changer votre mot de passe</h2>
        <p class="text-muted">Mettez à jour votre mot de passe pour sécuriser votre compte</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="stats-card password-card p-4">
            {% if form.errors %}
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i> Veuillez corriger les erreurs ci-dessous.
            </div>
            {% endif %}
            
            {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <form method="post" id="password-change-form">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="id_old_password" class="form-label">Mot de passe actuel</label>
                    {{ form.old_password }}
                    {% if form.old_password.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.old_password.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="id_new_password1" class="form-label">Nouveau mot de passe</label>
                    {{ form.new_password1 }}
                    <div class="password-strength-meter">
                        <div class="strength-value" id="strength-meter"></div>
                    </div>
                    {% if form.new_password1.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.new_password1.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-4">
                    <label for="id_new_password2" class="form-label">Confirmer le nouveau mot de passe</label>
                    {{ form.new_password2 }}
                    {% if form.new_password2.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.new_password2.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="password-tips">
                    <h6><i class="fas fa-shield-alt me-2"></i> Conseils pour un mot de passe sécurisé</h6>
                    <ul>
                        <li>Utilisez au moins 8 caractères</li>
                        <li>Combinez lettres majuscules et minuscules</li>
                        <li>Incluez des chiffres et des caractères spéciaux</li>
                        <li>Évitez les informations personnelles faciles à deviner</li>
                        <li>N'utilisez pas le même mot de passe que sur d'autres sites</li>
                    </ul>
                </div>
                
                <div class="d-flex justify-content-between mt-4">
                    <a href="{% url 'accounts:profile' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i> Annuler
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-key me-2"></i> Mettre à jour le mot de passe
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('id_new_password1');
        const strengthMeter = document.getElementById('strength-meter');
        
        function checkPasswordStrength(password) {
            let strength = 0;
            
            // Longueur minimale
            if (password.length >= 8) strength += 1;
            
            // Complexité: majuscules, minuscules, chiffres et caractères spéciaux
            if (/[A-Z]/.test(password)) strength += 1;
            if (/[a-z]/.test(password)) strength += 1;
            if (/[0-9]/.test(password)) strength += 1;
            if (/[^A-Za-z0-9]/.test(password)) strength += 1;
            
            return strength;
        }
        
        function updateStrengthMeter() {
            const password = passwordInput.value;
            const strength = checkPasswordStrength(password);
            
            // Réinitialiser les classes
            strengthMeter.className = 'strength-value';
            
            // Appliquer la classe appropriée
            if (password.length === 0) {
                strengthMeter.style.width = '0%';
            } else if (strength <= 2) {
                strengthMeter.classList.add('strength-weak');
            } else if (strength === 3) {
                strengthMeter.classList.add('strength-medium');
            } else if (strength === 4) {
                strengthMeter.classList.add('strength-good');
            } else {
                strengthMeter.classList.add('strength-strong');
            }
        }
        
        // Événement pour mettre à jour le compteur de force
        if (passwordInput) {
            passwordInput.addEventListener('input', updateStrengthMeter);
        }
    });
</script>
{% endblock %} 